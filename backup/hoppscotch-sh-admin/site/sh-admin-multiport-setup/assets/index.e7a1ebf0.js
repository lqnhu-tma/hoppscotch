import{d as _e,u as fe,f as p,o as _,l as D,w,a as u,k as n,j as o,J as he,K as be,q as ye,L as Ne,c as $,g,M as Oe,D as ee,e as ce,b as qe,h as q,r as Ke,i as Qe,t as v,n as I,N as Ye,O as ze,P as Fe,m as Je,Q as se,R as Xe,v as Ge,x as We,y as Ze}from"./index.38a058b6.js";import{a as es}from"./index.9173405f.js";import{u as ss}from"./usePagedQuery.4d20df8e.js";import{U as ts,M as ns,a as os,b as ls,c as as,D as is,d as rs}from"./graphql.96e353c8.js";import{I as de,a as us,h as cs}from"./user-check.8766c5d0.js";import{c as ds}from"./clipboard.946f3457.js";import{I as ms}from"./more-horizontal.e4fc6cb3.js";import{I as me}from"./trash.ccf2245b.js";import{I as ve}from"./user-minus.8c94a8fb.js";import{I as vs}from"./user-plus.af0ab934.js";import{f as pe}from"./index.a5da96cc.js";const ps={class:"flex space-x-2"},_s=_e({__name:"InviteModal",props:{smtpEnabled:{type:Boolean}},emits:["hide-modal","send-invite","copy-invite-link"],setup(T,{emit:e}){const c=fe(),U=e,M=p(""),K=()=>{U("hide-modal")};return(Q,f)=>{const Y=he,S=be,h=ye,i=Ne;return _(),D(i,{dialog:"",title:n(c)("users.invite_user"),onClose:f[4]||(f[4]=k=>U("hide-modal"))},{body:w(()=>[u(Y,{modelValue:M.value,"onUpdate:modelValue":f[0]||(f[0]=k=>M.value=k),label:n(c)("users.email_address"),"input-styles":"floating-input",onSubmit:f[1]||(f[1]=k=>U("send-invite",M.value))},null,8,["modelValue","label"])]),footer:w(()=>[o("span",ps,[u(S,{disabled:!Q.smtpEnabled,label:n(c)("users.send_invite"),onClick:f[2]||(f[2]=k=>U("send-invite",M.value))},null,8,["disabled","label"]),u(h,{label:n(c)("users.cancel"),outline:"",filled:"",onClick:K},null,8,["label"])]),u(h,{label:n(c)("users.copy_link"),outline:"",filled:"",onClick:f[3]||(f[3]=k=>U("copy-invite-link",M.value))},null,8,["label"])]),_:1},8,["title"])}}}),fs={preserveAspectRatio:"xMidYMid meet",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},hs=o("g",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"},[o("circle",{cx:"11",cy:"11",r:"8"}),o("path",{d:"m21 21l-4.3-4.3"})],-1),bs=[hs];function ys(T,e){return _(),$("svg",fs,[...bs])}const gs={name:"lucide-search",render:ys},ks={preserveAspectRatio:"xMidYMid meet",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},xs=o("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"m15 18l-6-6l6-6"},null,-1),ws=[xs];function Us(T,e){return _(),$("svg",ks,[...ws])}const Ms={name:"lucide-chevron-left",render:Us},As={preserveAspectRatio:"xMidYMid meet",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Is=o("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"m9 18l6-6l-6-6"},null,-1),$s=[Is];function Cs(T,e){return _(),$("svg",As,[...$s])}const Ds={name:"lucide-chevron-right",render:Cs},Ts={preserveAspectRatio:"xMidYMid meet",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Ss=o("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M18 6L6 18M6 6l12 12"},null,-1),Bs=[Ss];function Hs(T,e){return _(),$("svg",Ts,[...Bs])}const Rs={name:"lucide-x",render:Hs},Vs={class:"flex flex-col"},Es={class:"flex flex-col"},Ls={class:"text-lg font-bold text-secondaryDark"},Ps={class:"flex items-center space-x-4 mt-10 mb-5"},js={class:"flex"},Ns={class:"overflow-x-auto mb-5"},Os={class:"mb-3 flex items-center justify-end"},qs={class:"flex h-full w-10 items-center justify-center"},Ks={class:"flex w-full items-center bg-primary"},Qs={class:"px-6 py-2"},Ys={class:"px-6 py-2"},zs={class:"px-6 py-2"},Fs={class:"px-6 py-2"},Js=o("th",{class:"w-20 px-6 py-2"},null,-1),Xs={colspan:"6"},Gs={class:"flex justify-center p-3"},Ws={class:"py-2 px-7"},Zs={class:"flex items-center space-x-2"},et={key:0,class:"text-xs font-medium px-3 py-0.5 rounded-full bg-green-900 text-green-300"},st={class:"py-2 px-7 truncate"},tt={class:"py-2 px-7"},nt={class:"text-gray-400 text-tiny"},ot={class:"py-2 px-7"},lt={class:"mt-2 mr-5"},at=["onKeyup"],it={key:0,class:"fixed m-2 bottom-0 left-40 right-0 w-min mx-auto shadow-2xl"},rt={class:"flex justify-center items-end bg-primaryLight border border-divider rounded-md mb-5"},y=20,kt=_e({__name:"index",setup(T){const e=fe(),c=Ze(),U=s=>pe(new Date(s),"dd-MM-yyyy"),M=s=>pe(new Date(s),"hh:mm a"),K=s=>s?es(s).value:e("users.not_available"),Q=[{key:"displayName",label:e("users.name")},{key:"email",label:e("users.email")},{key:"createdOn",label:e("users.created_on")},{key:"lastActiveOn",label:e("users.last_active_on")},{key:"",label:""}],{fetching:f,error:Y,refetch:S,list:h}=ss(ts,s=>s.infra.allUsersV2,y,{searchString:"",take:y,skip:0}),i=p([]),k=g(()=>i.value.some(s=>s.isAdmin)),te=g(()=>k.value?i.value.some(s=>!s.isAdmin):!0);let B=null;Oe(()=>{B&&clearTimeout(B)});const z=(s,t)=>{B&&clearTimeout(B),B=setTimeout(s,t)},x=p(""),ne=p(""),oe=async s=>{ne.value=s,s.length===0?await S({searchString:"",take:y,skip:(d.value-1)*y}):await S({searchString:s,take:J.value,skip:0}),d.value=1};ee(x,()=>{x.value.length===0?oe(x.value):z(()=>{oe(x.value)},500)});const le=g(()=>ne.value.length>0?h.value.slice((d.value-1)*y,d.value*y):h.value),H=p(!1);ee(f,s=>{s&&(H.value=!0,z(()=>{H.value=!1},500))});const d=p(1),{data:F}=ce({query:ns}),J=g(()=>{var s;return(s=F==null?void 0:F.value)==null?void 0:s.infra.usersCount}),ae=s=>{const t=s===0,m=t&&d.value>1;(!t&&d.value<X.value||m)&&(d.value+=t?-1:1)},X=g(()=>J.value?x.value.length>0?Math.ceil(h.value.length/y):Math.ceil(J.value/y):0);ee(d,async()=>{d.value<1||d.value>X.value||(x.value.length>0?(H.value=!0,z(()=>H.value=!1,500)):await S({searchString:"",take:y,skip:(d.value-1)*y}))});const ge=qe(),ke=s=>ge.push("/users/"+s.uid),{data:G}=ce({query:os}),ie=g(()=>{var s;return(s=G==null?void 0:G.value)==null?void 0:s.isSMTPEnabled}),L=p(!1),xe=q(ls),re=async s=>{const t=s.trim();if(t){if(t==="")return c.error(e("users.valid_email")),!1}else return c.error(e("state.invalid_email")),!1;const m={inviteeEmail:t},a=await xe.executeMutation(m);if(a.error){const{message:r}=a.error,b=se(r);return b?c.error(e(b)):c.error(e("state.email_failure")),!1}else return ie.value&&c.success(e("state.email_success")),L.value=!1,!0},we=async s=>{var a;if(!await re(s))return;const m=(a=Object.create(globalThis.import_meta_env||null).VITE_BASE_URL)!=null?a:"";ds(m),c.success(e("state.link_copied_to_clipboard"))},R=p(!1),P=p(null),Ue=q(as),C=g(()=>i.value.length>1),Me=s=>{R.value=!0,P.value=s},Ae=()=>{R.value=!1,P.value=null},Ie=async s=>{const t=s?[s]:i.value.map(r=>r.uid),m={userUIDs:t};(await Ue.executeMutation(m)).error?c.error(C.value?e("state.users_to_admin_failure"):e("state.admin_failure")):(c.success(C.value?e("state.users_to_admin_success"):e("state.admin_success")),h.value=h.value.map(r=>({...r,isAdmin:t.includes(r.uid)?!0:r.isAdmin})),i.value.splice(0,i.value.length)),R.value=!1,P.value=null},V=p(!1),j=p(null),$e=q(is),Ce=s=>{V.value=!0,j.value=s},De=()=>{V.value=!1,j.value=null},Te=g(()=>i.value.length>1),Se=async s=>{const t=s?[s]:i.value.map(r=>r.uid),m={userUIDs:t},a=await $e.executeMutation(m);if(a.error){if(se(a.error.message))return c.error(e(se(a.error.message)));c.error(C.value?e("state.remove_admin_from_users_failure"):e("state.remove_admin_failure"))}else c.success(C.value?e("state.remove_admin_from_users_success"):e("state.remove_admin_success")),h.value=h.value.map(r=>({...r,isAdmin:t.includes(r.uid)?!1:r.isAdmin})),i.value.splice(0,i.value.length);V.value=!1,j.value=null},E=p(!1),N=p(null),Be=q(rs),He=s=>{E.value=!0,N.value=s},Re=()=>{E.value=!1,N.value=null},Ve=g(()=>i.value.length>1),Ee=async s=>{var r;const m={userUIDs:s?[s]:i.value.map(b=>b.uid)},a=await Be.executeMutation(m);if(a.error){const b=C.value?e("state.delete_users_failure"):e("state.delete_user_failure");c.error(b)}else{const b=((r=a.data)==null?void 0:r.removeUsersByAdmin)||[],O=b.filter(A=>A.isDeleted).map(A=>A.userUID);cs(b),h.value=h.value.filter(A=>!O.includes(A.uid)),i.value.splice(0,i.value.length)}E.value=!1,N.value=null};return(s,t)=>{const m=be,a=ye,r=gs,b=he,O=Xe,A=Ke("tippy"),Le=Ge,Pe=_s,W=We,je=Qe("tippy");return _(),$("div",Vs,[o("div",Es,[o("h1",Ls,v(n(e)("users.users")),1),o("div",Ps,[u(m,{label:n(e)("users.invite_user"),onClick:t[0]||(t[0]=l=>L.value=!0),icon:n(vs)},null,8,["label","icon"]),o("div",js,[u(a,{outline:"",filled:"",label:n(e)("users.pending_invites"),to:"/users/invited"},null,8,["label"])])]),o("div",Ns,[o("div",Os,[u(a,{outline:"",filled:"",icon:n(Ms),disabled:d.value===1,onClick:t[1]||(t[1]=l=>ae(0))},null,8,["icon","disabled"]),o("div",qs,[o("span",null,v(d.value),1)]),u(a,{outline:"",filled:"",icon:n(Ds),disabled:d.value>=X.value,onClick:t[2]||(t[2]=l=>ae(1))},null,8,["icon","disabled"])]),u(Le,{list:le.value,"onUpdate:list":t[5]||(t[5]=l=>le.value=l),"selected-rows":i.value,"onUpdate:selectedRows":t[6]||(t[6]=l=>i.value=l),headings:Q,loading:H.value,onOnRowClicked:ke},{extension:w(()=>[o("div",Ks,[u(r,{class:"mx-3 text-xs"}),u(b,{modelValue:x.value,"onUpdate:modelValue":t[3]||(t[3]=l=>x.value=l),styles:"w-full bg-primary py-1","input-styles":"h-full border-none",placeholder:n(e)("users.searchbar_placeholder")},null,8,["modelValue","placeholder"])])]),head:w(()=>[o("th",Qs,v(n(e)("users.name")),1),o("th",Ys,v(n(e)("users.email")),1),o("th",zs,v(n(e)("users.created_on")),1),o("th",Fs,v(n(e)("users.last_active_on")),1),Js]),"empty-state":w(()=>[o("td",Xs,[o("span",Gs,v(n(Y)?n(e)("users.load_list_error"):n(e)("users.no_users")),1)])]),body:w(({row:l})=>{var ue;return[o("td",Ws,[o("div",Zs,[o("span",null,v((ue=l.displayName)!=null?ue:n(e)("users.unnamed")),1),l.isAdmin?(_(),$("span",et,v(n(e)("users.admin")),1)):I("",!0)])]),o("td",st,v(l.email),1),o("td",tt,[Ye(v(U(l.createdOn))+" ",1),o("div",nt,v(M(l.createdOn)),1)]),o("td",ot,v(K(l.lastActiveOn)),1),o("td",{onClick:t[4]||(t[4]=ze(()=>{},["stop"])),class:"flex justify-end w-20"},[o("div",lt,[u(A,{interactive:"",trigger:"click",theme:"popover"},{content:w(({hide:Z})=>[o("div",{ref:"tippyActions",class:"flex flex-col focus:outline-none",tabindex:"0",onKeyup:Fe(ut=>Z(),["escape"])},[u(O,{icon:l.isAdmin?n(ve):n(de),label:l.isAdmin?n(e)("users.remove_admin_status"):n(e)("users.make_admin"),class:"!hover:bg-emerald-600",onClick:()=>{l.isAdmin?Ce(l.uid):Me(l.uid),Z()}},null,8,["icon","label","onClick"]),l.isAdmin?I("",!0):(_(),D(O,{key:0,icon:n(me),label:n(e)("users.delete_user"),class:"!hover:bg-red-600",onClick:()=>{He(l.uid),Z()}},null,8,["icon","label","onClick"]))],40,at)]),default:w(()=>[Je(u(a,{icon:n(ms)},null,8,["icon"]),[[je,{theme:"tooltip"}]])]),_:2},1024)])])]}),_:1},8,["list","selected-rows","loading"]),i.value.length?(_(),$("div",it,[o("div",rt,[u(a,{icon:n(us),label:n(e)("state.selected",{count:i.value.length}),class:"py-4 border-divider rounded-r-none bg-emerald-800 text-secondaryDark"},null,8,["icon","label"]),te.value?(_(),D(a,{key:0,icon:n(de),label:n(e)("users.make_admin"),class:"py-4 border-divider border-r-1 rounded-none hover:bg-emerald-600",onClick:t[7]||(t[7]=l=>R.value=!0)},null,8,["icon","label"])):I("",!0),k.value?(_(),D(a,{key:1,icon:n(ve),label:n(e)("users.remove_admin_status"),class:"py-4 border-divider border-r-1 rounded-none hover:bg-orange-500",onClick:t[8]||(t[8]=l=>V.value=!0)},null,8,["icon","label"])):I("",!0),te.value?(_(),D(a,{key:2,icon:n(me),label:n(e)("users.delete_users"),class:"py-4 border-divider rounded-none hover:bg-red-500",onClick:t[9]||(t[9]=l=>E.value=!0)},null,8,["icon","label"])):I("",!0),u(a,{icon:n(Rs),label:n(e)("state.clear_selection"),class:"py-4 border-divider rounded-l-none text-secondaryDark bg-red-600 hover:bg-red-500",onClick:t[10]||(t[10]=l=>i.value.splice(0,i.value.length))},null,8,["icon","label"])])])):I("",!0)])]),L.value?(_(),D(Pe,{key:0,"smtp-enabled":ie.value,onHideModal:t[11]||(t[11]=l=>L.value=!1),onSendInvite:re,onCopyInviteLink:we},null,8,["smtp-enabled"])):I("",!0),u(W,{show:R.value,title:C.value?n(e)("state.confirm_users_to_admin"):n(e)("state.confirm_user_to_admin"),onHideModal:Ae,onResolve:t[12]||(t[12]=l=>Ie(P.value))},null,8,["show","title"]),u(W,{show:V.value,title:Te.value?n(e)("state.confirm_admins_to_users"):n(e)("state.confirm_admin_to_user"),onHideModal:De,onResolve:t[13]||(t[13]=l=>Se(j.value))},null,8,["show","title"]),u(W,{show:E.value,title:Ve.value?n(e)("state.confirm_users_deletion"):n(e)("state.confirm_user_deletion"),onHideModal:Re,onResolve:t[14]||(t[14]=l=>Ee(N.value))},null,8,["show","title"])])}}});export{kt as default};
