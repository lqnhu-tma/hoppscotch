import{d as J,i as ae,m as X,o as u,l as W,k as e,q as Z,c as _,j as a,u as ee,f as k,h as P,a as i,t as d,w as L,N as ce,n as F,s as ne,v as de,x as re,y as se,g as z,F as le,X as te,Y as oe,a5 as me,am as _e,K as pe,J as ve,az as fe,b as he,p as ye,a7 as be,a8 as xe}from"./index.96dfa614.js";import{_ as ke}from"./chevron-down.7be1c234.js";import{r as ge,a as $e}from"./index.340b5eca.js";import{u as Ue}from"./usePagedQuery.bb9cde27.js";import{c as De}from"./clipboard.946f3457.js";import{a as we,I as qe,h as Ie}from"./user-check.945fb6ec.js";import{I as Ae,a as Ce,b as Re}from"./save.4a4c0fce.js";import{I as ie}from"./trash.f5ccfce4.js";import{u as Se,v as Me,w as Te,x as Ne,c as He,D as Be,d as Oe}from"./graphql.96e353c8.js";import{f as G}from"./index.a5da96cc.js";import{I as Ve}from"./user-minus.cdd8f20a.js";import{u as je}from"./useClientHandler.4a51367d.js";const Le=J({__name:"AutoResetIcon",props:{title:{},color:{default:"white"},resetColor:{default:"emerald"},icon:{}},emits:["click"],setup(N,{emit:s}){const t=N,f=s,g=ge(t.icon.default,1e3),$=()=>{g.value=t.icon.temporary,f("click")};return(H,R)=>{const p=Z,S=ae("tippy");return X((u(),W(p,{title:H.title,icon:e(g),color:e(g)===t.icon.default?t.color:t.resetColor,class:"px-3",onClick:$},null,8,["title","icon","color"])),[[S,{theme:"tooltip"}]])}}}),Ee={preserveAspectRatio:"xMidYMid meet",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Pe=a("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6m4-3h6v6m-11 5L21 3"},null,-1),ze=[Pe];function Fe(N,s){return u(),_("svg",Ee,[...ze])}const Je={name:"lucide-external-link",render:Fe},Ye={class:"px-4 mt-7"},Ke={key:0,class:"flex justify-center"},Qe={key:1},Xe={key:2},Ge={class:"px-6 py-2"},We={class:"px-6 py-2 w-30"},Ze={class:"px-6 py-2"},es={class:"px-6 py-2 text-center"},ss={class:"flex py-4 px-7 max-w-50"},ts={class:"truncate"},os={class:"py-4 px-7 w-96"},as={class:"py-2 px-7"},ns={class:"text-gray-400 text-tiny"},rs={class:"flex justify-center"},ls={class:"mr-2"},Q=30,is=J({__name:"SharedRequests",props:{email:{}},setup(N){var h;const s=ee(),t=se(),f=N,g=n=>G(new Date(n),"dd-MM-yyyy"),$=n=>G(new Date(n),"hh:mm a"),{fetching:H,error:R,goToNextPage:p,refetch:S,list:y,hasNextPage:b}=Ue(Se,n=>n.infra.allShortcodes,Q,{cursor:void 0,take:Q,email:f.email},n=>n.id),I=[{key:"id",label:s("shared_requests.id")},{key:"request",label:s("shared_requests.url")},{key:"createdOn",label:s("shared_requests.created_on")},{key:"action",label:s("shared_requests.action")}],M=n=>JSON.parse(n).endpoint,T=(h=Object.create(globalThis.import_meta_env||null).VITE_SHORTCODE_BASE_URL)!=null?h:"https://hopp.sh",x=n=>{De(`${T}/r/${n}`),t.success(s("state.copied_to_clipboard"))},m=k(!1),B=k(null),A=P(Me),O=n=>{m.value=!0,B.value=n},r=async n=>{if(!n){m.value=!1,t.error(s("state.delete_request_failure"));return}const v={codeID:n};(await A.executeMutation(v)).error?t.error(s("state.delete_request_failure")):(y.value=y.value.filter(D=>D.id!==n),S(),t.success(s("state.delete_request_success"))),m.value=!1,B.value=null};return(n,v)=>{const U=ne,D=Z,C=Le,V=de,o=ke,l=re,w=ae("tippy");return u(),_("div",Ye,[e(H)?(u(),_("div",Ke,[i(U)])):e(R)?(u(),_("div",Qe,d(e(s)("shared_requests.load_list_error")),1)):e(y).length===0?(u(),_("div",Xe,d(e(s)("users.no_shared_requests")),1)):(u(),W(V,{key:3,headings:I,list:e(y)},{head:L(()=>[a("th",Ge,d(e(s)("shared_requests.id")),1),a("th",We,d(e(s)("shared_requests.url")),1),a("th",Ze,d(e(s)("shared_requests.created_on")),1),a("th",es,d(e(s)("shared_requests.action")),1)]),body:L(({row:c})=>[a("td",ss,[a("span",ts,d(c.id),1)]),a("td",os,d(M(c.request)),1),a("td",as,[ce(d(g(c.createdOn))+" ",1),a("div",ns,d($(c.createdOn)),1)]),a("td",rs,[X(i(D,{title:e(s)("shared_requests.open_request"),to:`${e(T)}/r/${c.id}`,blank:!0,icon:e(Je),class:"px-3 text-emerald-500 hover:text-accent"},null,8,["title","to","icon"]),[[w,{theme:"tooltip"}]]),i(C,{title:e(s)("shared_requests.copy"),icon:{default:e(Ae),temporary:e(we)},onClick:j=>x(c.id)},null,8,["title","icon","onClick"]),X(i(D,{title:e(s)("shared_requests.delete"),icon:e(ie),color:"red",class:"px-3",onClick:j=>O(c.id)},null,8,["title","icon","onClick"]),[[w,{theme:"tooltip"}]])])]),_:1},8,["list"])),e(b)&&e(y).length>=Q?(u(),_("div",{key:4,class:"flex items-center w-28 px-3 py-2 mt-5 mx-auto font-semibold text-secondaryDark bg-divider hover:bg-dividerDark rounded-3xl cursor-pointer",onClick:v[0]||(v[0]=(...c)=>e(p)&&e(p)(...c))},[a("span",ls,d(e(s)("shared_requests.show_more")),1),i(o)])):F("",!0),i(l,{show:m.value,title:e(s)("shared_requests.confirm_request_deletion"),onHideModal:v[1]||(v[1]=c=>m.value=!1),onResolve:v[2]||(v[2]=c=>r(B.value))},null,8,["show","title"])])}}}),us={class:"rounded-md"},cs={class:"grid gap-6"},ds=["src"],ms={key:2,class:"absolute left-16 bottom-0 text-xs font-medium px-3 py-0.5 rounded-full bg-green-900 text-green-300"},_s={key:0,class:"flex flex-col space-y-3"},ps={class:"text-accentContrast",for:"teamname"},vs={key:1},fs=["for"],hs={class:"w-full p-3 mt-2 bg-divider border-gray-600 rounded-md"},ys={class:"flex justify-start mt-8"},bs=J({__name:"Details",props:{user:{}},emits:["delete-user","make-admin","remove-admin","update-user-name"],setup(N,{emit:s}){const t=ee(),f=se(),g=N,$=s,H=r=>G(new Date(r),"d-MM-yyyy  hh:mm a"),{uid:R,displayName:p,email:S,createdOn:y,lastActiveOn:b}=g.user,I={uid:{condition:R,label:t("users.uid"),value:R},displayName:{condition:!0,label:t("users.name"),value:p!=null?p:t("users.unnamed")},email:{condition:S,label:t("users.email"),value:S},createdOn:{condition:y,label:t("users.created_on"),value:H(y)},lastActiveOn:{condition:b,label:t("users.last_active_on"),value:b?$e(b).value:t("users.not_available")}},M=z({get:()=>g.user.displayName,set:r=>r}),T=k("");le(()=>{p&&(T.value=p)});const x=z({get:()=>T.value,set:r=>{T.value=r}}),m=k(!1),B=P(Te),A=()=>{m.value?M.value!==x.value?O():m.value=!1:m.value=!0},O=async()=>{var n;if(((n=x.value)==null?void 0:n.trim())===""){f.error(t("users.empty_name"));return}const r={userUID:R,name:x.value};(await B.executeMutation(r)).error?f.error(t("state.rename_user_failure")):(m.value=!1,f.success(t("state.rename_user_success")),$("update-user-name",x.value),M.value=x.value)};return(r,h)=>{const n=_e,v=pe,U=ve,D=Z;return u(),_("div",us,[a("div",cs,[a("div",{class:te(["relative",r.user.photoURL?"h-20 w-20":"bg-primaryDark w-16 p-3 rounded-2xl mb-3"])},[r.user.photoURL?(u(),_("img",{key:0,class:"object-cover rounded-3xl mb-3",src:r.user.photoURL},null,8,ds)):(u(),W(n,{key:1,class:"text-4xl"})),r.user.isAdmin?(u(),_("span",ms,d(e(t)("users.admin")),1)):F("",!0)],2),(u(),_(oe,null,me(I,(C,V)=>(u(),_(oe,{key:V},[V==="displayName"?(u(),_("div",_s,[a("label",ps,d(e(t)("users.name")),1),a("div",{class:te(["flex bg-divider rounded-md items-stretch flex-1 border border-divider",{"!border-accent":m.value}])},[i(U,{modelValue:x.value,"onUpdate:modelValue":h[0]||(h[0]=o=>x.value=o),styles:"bg-transparent flex-1 rounded-md !rounded-r-none disabled:select-none border-r-0 disabled:cursor-default disabled:opacity-50",placeholder:e(t)("users.name"),disabled:!m.value},{button:L(()=>[i(v,{class:"!rounded-l-none",filled:"",icon:m.value?e(Ce):e(Re),label:m.value?e(t)("users.rename"):e(t)("users.edit"),onClick:A},null,8,["icon","label"])]),_:1},8,["modelValue","placeholder","disabled"])],2)])):C.condition?(u(),_("div",vs,[a("label",{class:"text-secondaryDark",for:V},d(C.label),9,fs),a("div",hs,[a("span",null,d(C.value),1)])])):F("",!0)],64))),64))]),a("div",ys,[i(v,{icon:r.user.isAdmin?e(Ve):e(qe),label:r.user.isAdmin?e(t)("users.remove_admin_privilege"):e(t)("users.make_admin"),filled:"",outline:"",class:"mr-4",onClick:h[1]||(h[1]=C=>r.user.isAdmin?$("remove-admin",r.user.uid):$("make-admin",r.user.uid))},null,8,["icon","label"]),i(D,{icon:e(ie),label:e(t)("users.delete"),filled:"",outline:"",class:"mr-4 bg-red-600 text-white hover:text-gray-100",onClick:h[2]||(h[2]=C=>r.user.isAdmin?e(f).error(e(t)("state.remove_admin_to_delete_user")):$("delete-user",r.user.uid))},null,8,["icon","label"])])])}}}),xs={key:0,class:"flex justify-center"},ks={key:1,class:"text-lg"},gs={key:2,class:"flex flex-col space-y-4"},$s={class:"flex gap-x-3"},Us={class:"flex items-center space-x-3"},Ds={class:"text-lg text-accentContrast"},ws=a("span",null,"/",-1),qs={class:"text-lg text-accentContrast"},Is={class:"pb-8"},Ls=J({__name:"_id",setup(N){const s=ee(),t=se(),f=k("details"),g=z(()=>{switch(f.value){case"details":return s("users.details");case"requests":return s("shared_requests.title");default:return""}}),$=fe(),{fetching:H,error:R,data:p,fetchData:S}=je(Ne,{uid:$.params.id.toString()});le(async()=>{await S()});const y=z({get:()=>{var o;return(o=p.value)==null?void 0:o.infra.userInfo.displayName},set:o=>{o&&(p.value.infra.userInfo.displayName=o)}}),b=z({get:()=>{var o;return(o=p.value)==null?void 0:o.infra.userInfo},set:o=>{o&&(p.value.infra.userInfo=o)}}),I=k(!1),M=k(null),T=P(He),x=o=>{I.value=!0,M.value=o},m=async o=>{if(!o){I.value=!1,t.error(s("state.admin_failure"));return}const w={userUIDs:[o]};(await T.executeMutation(w)).error?t.error(s("state.admin_failure")):(t.success(s("state.admin_success")),b.value.isAdmin=!0),I.value=!1,M.value=null},B=P(Be),A=k(!1),O=k(null),r=o=>{A.value=!0,O.value=o},h=async o=>{if(!o){A.value=!1,t.error(s("state.remove_admin_failure"));return}const w={userUIDs:[o]};(await B.executeMutation(w)).error?t.error(s("state.remove_admin_failure")):(t.success(s("state.remove_admin_success")),b.value.isAdmin=!1),A.value=!1,O.value=null},n=he(),v=P(Oe),U=k(!1),D=k(null),C=o=>{U.value=!0,D.value=o},V=async o=>{var j;if(!o){U.value=!1,t.error(s("state.delete_user_failure"));return}const w={userUIDs:[o]},c=await v.executeMutation(w);if(c.error)t.error(s("state.delete_user_failure"));else{const E=((j=c.data)==null?void 0:j.removeUsersByAdmin)||[];Ie(E);const{isDeleted:Y}=E[0];Y&&n.push("/users")}U.value=!1,D.value=null};return(o,l)=>{const w=ne,c=ye,j=bs,E=be,Y=is,ue=xe,K=re;return e(H)?(u(),_("div",xs,[i(w)])):e(R)?(u(),_("div",ks,d(e(s)("users.load_info_error")),1)):b.value?(u(),_("div",gs,[a("div",$s,[a("button",{class:"p-2 mb-2 rounded-3xl bg-divider",onClick:l[0]||(l[0]=q=>e(n).push("/users"))},[i(c,{class:"text-xl"})]),a("div",Us,[a("h1",Ds,d(y.value),1),ws,a("h2",qs,d(g.value),1)])]),a("div",Is,[i(ue,{modelValue:f.value,"onUpdate:modelValue":l[2]||(l[2]=q=>f.value=q),"render-inactive-tabs":""},{default:L(()=>[i(E,{id:"details",label:e(s)("users.details")},{default:L(()=>[i(j,{user:b.value,onDeleteUser:C,onMakeAdmin:x,onRemoveAdmin:r,onUpdateUserName:l[1]||(l[1]=q=>y.value=q),class:"py-8 px-4"},null,8,["user"])]),_:1},8,["label"]),i(E,{id:"requests",label:e(s)("shared_requests.title")},{default:L(()=>[i(Y,{email:b.value.email},null,8,["email"])]),_:1},8,["label"])]),_:1},8,["modelValue"])]),i(K,{show:U.value,title:e(s)("state.confirm_user_deletion"),onHideModal:l[3]||(l[3]=q=>U.value=!1),onResolve:l[4]||(l[4]=q=>V(D.value))},null,8,["show","title"]),i(K,{show:I.value,title:e(s)("state.confirm_user_to_admin"),onHideModal:l[5]||(l[5]=q=>I.value=!1),onResolve:l[6]||(l[6]=q=>m(M.value))},null,8,["show","title"]),i(K,{show:A.value,title:e(s)("state.confirm_admin_to_user"),onHideModal:l[7]||(l[7]=q=>A.value=!1),onResolve:l[8]||(l[8]=q=>h(O.value))},null,8,["show","title"])])):F("",!0)}}});export{Ls as default};
