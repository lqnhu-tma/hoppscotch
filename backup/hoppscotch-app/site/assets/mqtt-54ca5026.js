import{_ as De}from"./chevron-down-71482dd4.js";import{o as _,d as w,e as o,f as Z,M as J,h as $,Y as X,r as ce,i as G,c as E,w as m,Z as S,j as e,a,l as Q,F as B,n as I,ao as U,k as K,m as re,v as Y,S as de,au as ue,cf as qe,cg as pe,aE as me,J as _e,ap as ve,H as be,$ as ne,aX as Oe,U as Ve,ae as Re,af as D,ai as H,g as He,aj as Qe,ch as V,ci as Be,am as Ue,al as Ae,an as W,E as ae,cj as Fe,z as Pe,ck as je,cl as ze,cm as We,cn as Ge,co as Ke,cp as Ze,cq as Je,cr as Xe,cs as Ye,ct as et,cu as tt,cv as ot,cw as st,bc as ie,aD as lt,aZ as nt,aF as at,cx as it}from"./index-7d8b347c.js";import{W as ct,_ as rt}from"./regex-774f4422.js";import{_ as dt,a as ut}from"./Communication-3ed9aea8.js";import{_ as pt}from"./EnvInput-6bb7a0e0.js";import"./utils-7c6dc436.js";import"./arrow-down-075bb51a.js";import"./json-5c9dc7ca.js";import"./newOutline-83220d1e.js";import"./files-905044f3.js";import"./TaskOption-e7d917a4.js";import"./json-91191aeb.js";const mt={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},_t=o("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"m9.06 11.9l8.07-8.06a2.85 2.85 0 1 1 4.03 4.03l-8.06 8.08m-6.03-1.01c-1.66 0-3 1.35-3 3.02c0 1.33-2.5 1.52-2 2.02c1.08 1.1 2.49 2.02 4 2.02c2.2 0 4-1.8 4-4.04a3.01 3.01 0 0 0-3-3.02z"},null,-1),vt=[_t];function bt(L,l){return _(),w("svg",mt,[...vt])}const ft={name:"lucide-brush",render:bt},gt={class:"mb-4 flex justify-between"},ht={class:"flex items-center divide-x divide-divider rounded border border-divider"},yt={class:"mx-4"},xt={class:"flex flex-col",role:"menu"},Ct={class:"relative flex flex-col"},St=["onKeyup"],wt={for:"selectLabelAdd"},Tt={class:"end-actions"},$t=["title"],kt={class:"flex space-x-2"},Nt=Z({__name:"Subscription",props:{show:{type:Boolean,default:!1},loadingState:{type:Boolean,default:!1}},emits:["hide-modal","submit"],setup(L,{emit:l}){const d=ve(),g=J(),c=L,u=l,n=$(2),f=$(""),v=$("#f58290");X(()=>c.show,()=>{f.value="",n.value=2;const k=Math.floor(Math.random()*16777215).toString(16);v.value=`#${k}`});const b=()=>{if(!f.value){d.error(g("mqtt.invalid_topic").toString());return}u("submit",{name:f.value,qos:n.value,color:v.value})},p=()=>{f.value="",n.value=2,u("hide-modal")};return(k,T)=>{const r=Y,y=de,M=be,q=ce("tippy"),A=ft,O=ue,h=qe,x=G("focus"),F=G("tippy");return L.show?(_(),E(h,{key:0,dialog:"",title:e(g)("mqtt.new"),onClose:p},{body:m(()=>[o("div",gt,[o("div",ht,[o("label",yt,S(e(g)("mqtt.qos")),1),a(q,{interactive:"",trigger:"click",theme:"popover"},{content:m(({hide:C})=>[o("div",xt,[(_(!0),w(B,null,Q(e(pe),N=>(_(),E(M,{key:`qos-${N}`,label:`${N}`,icon:n.value===N?e(me):e(_e),active:n.value===N,onClick:()=>{n.value=N,C()}},null,8,["label","icon","active","onClick"]))),128))])]),default:m(()=>[a(y,null,{default:m(()=>[a(r,{class:"pr-8",label:`${n.value}`},null,8,["label"])]),_:1})]),_:1})])]),o("div",Ct,[I(o("input",{id:"selectLabelAdd","onUpdate:modelValue":T[0]||(T[0]=C=>f.value=C),class:"input floating-input",placeholder:" ",type:"text",autocomplete:"off",onKeyup:K(b,["enter"])},null,40,St),[[U,f.value],[x]]),o("label",wt,S(e(g)("action.label")),1),o("span",Tt,[I((_(),w("label",{title:e(g)("mqtt.color"),for:"select-color",class:"group absolute inset-0 flex items-center justify-center hover:cursor-pointer"},[a(A,{class:"svg-icons text-accentContrast opacity-80 transition group-hover:opacity-100"})],8,$t)),[[F,{theme:"tooltip"}]]),I(o("input",{id:"select-color","onUpdate:modelValue":T[1]||(T[1]=C=>v.value=C),type:"color",class:"color-picker h-8 w-8 rounded bg-primary p-1"},null,512),[[U,v.value]])])])]),footer:m(()=>[o("span",kt,[a(O,{label:e(g)("mqtt.subscribe"),loading:L.loadingState,outline:"",onClick:b},null,8,["label","loading"]),a(r,{label:e(g)("action.cancel"),outline:"",filled:"",onClick:p},null,8,["label"])])]),_:1},8,["title"])):re("",!0)}}}),Et={class:"flex flex-1 flex-col"},It={class:"sticky top-upperPrimaryStickyFold z-10 flex flex-shrink-0 items-center justify-between overflow-x-auto border-b border-dividerLight bg-primary py-2 pl-4 pr-2"},Lt={class:"flex items-center"},Mt={class:"truncate font-semibold text-secondaryLight"},Dt={class:"flex"},qt={class:"flex h-full flex-1 border-dividerLight"},Ot={class:"w-1/3 border-r border-dividerLight"},Vt={class:"flex flex-1 border-b border-dividerLight"},Rt={class:"flex flex-1 border-b border-dividerLight"},Ht={class:"flex items-center border-b border-dividerLight"},Qt={class:"ml-4 text-secondaryLight"},Bt={class:"w-2/3"},Ut={class:"flex flex-1 border-b border-dividerLight"},At={class:"flex flex-1 border-b border-dividerLight"},Ft={class:"flex items-center justify-between border-b border-dividerLight px-4"},Pt={class:"flex items-center"},jt={class:"truncate font-semibold text-secondaryLight"},zt={class:"flex flex-col",role:"menu"},Wt=Z({__name:"ConnectionConfig",emits:["change"],setup(L,{emit:l}){const d=J(),g=l,c=$({username:"",password:"",keepAlive:"60",cleanSession:!0,lwTopic:"",lwMessage:"",lwQos:0,lwRetain:!1});return X(c,u=>{g("change",u)},{immediate:!0}),(u,n)=>{const f=Oe,v=pt,b=Y,p=de,k=be,T=ce("tippy");return _(),w("div",Et,[o("div",It,[o("span",Lt,[o("label",Mt,S(e(d)("mqtt.connection_config")),1)]),o("div",Dt,[a(f,{on:c.value.cleanSession,class:"px-2",onChange:n[0]||(n[0]=r=>c.value.cleanSession=!c.value.cleanSession)},{default:m(()=>[ne(S(e(d)("mqtt.clean_session")),1)]),_:1},8,["on"])])]),o("div",qt,[o("div",Ot,[o("div",Vt,[a(v,{modelValue:c.value.username,"onUpdate:modelValue":n[1]||(n[1]=r=>c.value.username=r),placeholder:e(d)("authorization.username")},null,8,["modelValue","placeholder"])]),o("div",Rt,[a(v,{modelValue:c.value.password,"onUpdate:modelValue":n[2]||(n[2]=r=>c.value.password=r),placeholder:e(d)("authorization.password")},null,8,["modelValue","placeholder"])]),o("div",Ht,[o("label",Qt,S(e(d)("mqtt.keep_alive")),1),a(v,{modelValue:c.value.keepAlive,"onUpdate:modelValue":n[3]||(n[3]=r=>c.value.keepAlive=r),placeholder:e(d)("mqtt.keep_alive")},null,8,["modelValue","placeholder"])])]),o("div",Bt,[o("div",Ut,[a(v,{modelValue:c.value.lwTopic,"onUpdate:modelValue":n[4]||(n[4]=r=>c.value.lwTopic=r),placeholder:e(d)("mqtt.lw_topic")},null,8,["modelValue","placeholder"])]),o("div",At,[a(v,{modelValue:c.value.lwMessage,"onUpdate:modelValue":n[5]||(n[5]=r=>c.value.lwMessage=r),placeholder:e(d)("mqtt.lw_message")},null,8,["modelValue","placeholder"])]),o("div",Ft,[o("div",Pt,[o("label",jt,S(e(d)("mqtt.lw_qos")),1),a(T,{interactive:"",trigger:"click",theme:"popover"},{content:m(({hide:r})=>[o("div",zt,[(_(!0),w(B,null,Q(e(pe),y=>(_(),E(k,{key:`qos-${y}`,label:`${y}`,icon:c.value.lwQos===y?e(me):e(_e),active:c.value.lwQos===y,onClick:()=>{c.value.lwQos=y,r()}},null,8,["label","icon","active","onClick"]))),128))])]),default:m(()=>[a(p,null,{default:m(()=>[a(b,{class:"ml-2 rounded-none pr-8",label:`${c.value.lwQos}`},null,8,["label"])]),_:1})]),_:1})]),a(f,{on:c.value.lwRetain,class:"py-2",onChange:n[6]||(n[6]=r=>c.value.lwRetain=!c.value.lwRetain)},{default:m(()=>[ne(S(e(d)("mqtt.lw_retain")),1)]),_:1},8,["on"])])])])])}}}),Gt={class:"sticky top-0 z-10 flex flex-shrink-0 space-x-2 overflow-x-auto bg-primary p-4"},Kt={class:"inline-flex flex-1 space-x-2"},Zt={class:"flex flex-1"},Jt=["placeholder","disabled"],Xt={for:"client-id",class:"truncate border-b border-t border-divider bg-primaryLight px-4 py-2 font-semibold text-secondaryLight"},Yt=["disabled"],eo={class:"sticky z-10 flex flex-shrink-0 flex-col divide-y divide-dividerLight overflow-x-auto rounded-t border-b border-dividerLight bg-primary"},to={class:"flex flex-1 justify-between"},oo={class:"flex"},so={key:1},lo={class:"group flex items-stretch"},no={class:"flex cursor-pointer items-center justify-center px-4"},ao=["onClick"],io={class:"truncate"},xo=Z({__name:"mqtt",setup(L){const l=J(),d=ve(),g=Ve(),{subscribeToStream:c}=Re(),u=D(ze,"",je),n=D(Ge,"",We),f=$({username:"",password:"",keepAlive:"60",cleanSession:!0,lwTopic:"",lwMessage:"",lwQos:0,lwRetain:!1}),v=D(Ze,[],Ke),b=D(Ye,new Xe,Je),p=H(b.value.connectionState$,"DISCONNECTED"),k=H(b.value.subscriptionState$,!1),T=H(b.value.subscribing$,!1),r=$(!0),y=$("");let M;const q=$(!1),A=He(()=>p.value==="CONNECTED"),O=H(b.value.subscribedTopics$,[]),h=D(tt,"",et),x=D(st,[],ot),F=t=>{f.value=t},C=t=>{q.value=t},N=({data:t})=>{t.url===u.value&&(r.value=t.result)};Qe(()=>{M=new ct,M.addEventListener("message",N),c(b.value.event$,t=>{switch(t==null?void 0:t.type){case"CONNECTING":v.value=[{payload:`${l("state.connecting_to",{name:u.value})}`,source:"info",color:"var(--accent-color)",ts:void 0}];break;case"CONNECTED":v.value=[{payload:`${l("state.connected_to",{name:u.value})}`,source:"info",color:"var(--accent-color)",ts:Date.now()}],d.success(`${l("state.connected")}`);break;case"MESSAGE_SENT":ee({prefix:`${t.message.topic}`,payload:t.message.message,source:"client",ts:Date.now()},t.message.topic);break;case"MESSAGE_RECEIVED":ee({prefix:`${t.message.topic}`,payload:t.message.message,source:"server",ts:t.time},t.message.topic);break;case"SUBSCRIBED":C(!1),V({payload:k.value?`${l("state.subscribed_success",{topic:t.topic})}`:`${l("state.unsubscribed_success",{topic:t.topic})}`,source:"server",ts:t.time});break;case"SUBSCRIPTION_FAILED":V({payload:k.value?`${l("state.subscribed_failed",{topic:y.value})}`:`${l("state.unsubscribed_failed",{topic:y.value})}`,source:"server",ts:t.time});break;case"ERROR":V({payload:xe(t.error),source:"info",color:"#ff5555",ts:t.time});break;case"DISCONNECTED":V({payload:l("state.disconnected_from",{name:u.value}).toString(),source:"disconnected",color:"#ff5555",ts:t.time}),d.error(`${l("state.disconnected")}`);break}})});const ee=(t,s)=>{s&&Be(s,t),V(t)},fe=Ue(function(){M.postMessage({type:"ws",url:u.value})},1e3);X(u,t=>{t&&fe()}),Ae(()=>{M.terminate()});const P=()=>{if(p.value==="DISCONNECTED")return b.value.connect(u.value,n.value,f.value);b.value.disconnect()},ge=t=>{var s;(s=b.value)==null||s.publish(t.eventName,t.message)},he=t=>{if(A.value){if(O.value.some(s=>s.name===t.name))return d.error(l("mqtt.already_subscribed").toString());b.value.subscribe(t)}else q.value=!1,d.error(l("mqtt.not_connected").toString())},ye=t=>{b.value.unsubscribe(t),te(t)},xe=t=>{if(typeof t=="string")return t;switch(t.type){case"CONNECTION_NOT_ESTABLISHED":return l("state.connection_lost").toString();case"SUBSCRIPTION_FAILED":return l("state.mqtt_subscription_failed",{topic:t.topic}).toString();case"PUBLISH_ERROR":return l("state.publish_error",{topic:t.topic}).toString();case"CONNECTION_LOST":return l("state.connection_lost").toString();case"CONNECTION_FAILED":return l("state.connection_failed").toString();default:return l("state.disconnected_from",{name:u.value}).toString()}},Ce=()=>{v.value=[]},Se=t=>{const{name:s,color:j}=t;if(x.value.some(z=>z.id===t.name))return h.value=t.name;x.value=[...x.value,{id:s,name:s,color:j,removable:!0,logs:[]}],h.value=s},we=t=>{const s=[...x.value];s.splice(t.newIndex,0,s.splice(t.oldIndex,1)[0]),x.value=s},te=t=>{x.value=x.value.filter(s=>s.id!==t)};return(t,s)=>{const j=ue,z=Wt,Te=dt,oe=ut,$e=rt,ke=it,Ne=Fe,R=Y,Ee=Pe,Ie=Nt,Le=De,se=G("tippy");return _(),E(Le,{"layout-id":"mqtt"},{primary:m(()=>[o("div",Gt,[o("div",Kt,[o("div",Zt,[I(o("input",{id:"mqtt-url","onUpdate:modelValue":s[0]||(s[0]=i=>W(u)?u.value=i:null),type:"url",autocomplete:"off",class:ae([{error:!r.value},"flex w-full flex-1 rounded-l border border-divider bg-primaryLight px-4 py-2 text-secondaryDark"]),placeholder:`${e(l)("mqtt.url")}`,disabled:e(p)==="CONNECTED"||e(p)==="CONNECTING",onKeyup:s[1]||(s[1]=K(i=>r.value?P():null,["enter"]))},null,42,Jt),[[U,e(u)]]),o("label",Xt,S(e(l)("mqtt.client_id")),1),I(o("input",{id:"client-id","onUpdate:modelValue":s[2]||(s[2]=i=>W(n)?n.value=i:null),class:"flex w-full flex-1 rounded-r border border-divider bg-primaryLight px-4 py-2 text-secondaryDark",spellcheck:"false",disabled:e(p)==="CONNECTED"||e(p)==="CONNECTING",onKeyup:s[3]||(s[3]=K(i=>r.value?P():null,["enter"]))},null,40,Yt),[[U,e(n)]])]),a(j,{id:"connect",disabled:!r.value,class:"w-32",label:e(p)==="CONNECTING"?e(l)("action.connecting"):e(p)==="DISCONNECTED"?e(l)("action.connect"):e(l)("action.disconnect"),loading:e(p)==="CONNECTING",onClick:P},null,8,["disabled","label","loading"])])]),o("div",{class:ae(["flex flex-1 flex-col",{"!hidden":e(p)==="CONNECTED"}])},[a(z,{onChange:F})],2),e(p)==="CONNECTED"?(_(),E(Te,{key:0,"show-event-field":e(h)==="all","is-connected":e(p)==="CONNECTED","event-field-styles":"top-upperPrimaryStickyFold","sticky-header-styles":e(h)==="all"?"top-upperSecondaryStickyFold":"top-upperPrimaryStickyFold",onSendMessage:s[4]||(s[4]=i=>ge(e(h)==="all"?i:{message:i.message,eventName:e(h)}))},null,8,["show-event-field","is-connected","sticky-header-styles"])):re("",!0)]),secondary:m(()=>[a(Ne,{id:"communication_tab",modelValue:e(h),"onUpdate:modelValue":s[6]||(s[6]=i=>W(h)?h.value=i:null),"can-add-new-tab":!1,onRemoveTab:te,onSort:we},{default:m(()=>[(_(!0),w(B,null,Q(e(x),i=>(_(),E(ke,{id:i.id,key:"removable_tab_"+i.id,label:i.name,"is-removable":i.removable},{prefix:m(()=>[a(oe,{style:ie({color:i.color}),class:"svg-icons h-4 w-4"},null,8,["style"])]),default:m(()=>[a($e,{title:e(l)("mqtt.log"),log:i.id==="all"?e(v):i.logs,onDelete:s[5]||(s[5]=le=>Ce())},null,8,["title","log"])]),_:2},1032,["id","label","is-removable"]))),128))]),_:1},8,["modelValue"])]),sidebar:m(()=>[o("div",eo,[o("div",to,[a(R,{icon:e(lt),label:e(l)("mqtt.new"),class:"!rounded-none",onClick:s[7]||(s[7]=i=>C(!0))},null,8,["icon","label"]),o("span",oo,[I(a(R,{to:"https://docs.hoppscotch.io/documentation/getting-started/realtime/mqtt",blank:"",title:e(l)("app.wiki"),icon:e(nt)},null,8,["title","icon"]),[[se,{theme:"tooltip"}]])])])]),e(O).length===0?(_(),E(Ee,{key:0,src:`/images/states/${e(g).value}/pack.svg`,alt:`${e(l)("empty.subscription")}`,text:`${e(l)("empty.subscription")}`},{body:m(()=>[a(R,{label:e(l)("mqtt.new"),filled:"",outline:"",onClick:s[8]||(s[8]=i=>C(!0))},null,8,["label"])]),_:1},8,["src","alt","text"])):(_(),w("div",so,[(_(!0),w(B,null,Q(e(O),(i,le)=>(_(),w("div",{key:`subscription-${le}`,class:"flex flex-col"},[o("div",lo,[o("span",no,[a(oe,{style:ie({color:i.color}),class:"svg-icons h-4 w-4"},null,8,["style"])]),o("span",{class:"flex min-w-0 flex-1 cursor-pointer py-2 pr-2 transition group-hover:text-secondaryDark",onClick:Me=>Se(i)},[o("span",io,S(i.name),1)],8,ao),I(a(R,{icon:e(at),color:"red",title:e(l)("mqtt.unsubscribe"),class:"hidden group-hover:inline-flex","data-testid":"unsubscribe_mqtt_subscription",onClick:Me=>ye(i.name)},null,8,["icon","title","onClick"]),[[se,{theme:"tooltip"}]])])]))),128))])),a(Ie,{show:q.value,"loading-state":e(T),onSubmit:he,onHideModal:s[9]||(s[9]=i=>C(!1))},null,8,["show","loading-state"])]),_:1})}}});export{xo as default};
//# sourceMappingURL=mqtt-54ca5026.js.map
