import{_ as X}from"./chevron-down-71482dd4.js";import{W as ee,_ as oe}from"./regex-774f4422.js";import{f as te,M as ae,U as se,ae as ne,h as E,af as y,g as le,ag as ce,ah as re,ai as ie,Y as V,aj as de,ak as S,al as ue,am as pe,i as me,o as O,c as L,w as d,e as c,a as n,j as e,an as ge,Z as ve,n as p,E as _e,ao as be,m as fe,ap as ye,aq as Se,ar as Ce,as as ke,at as he,au as Ee,x as we,ad as $e,v as Ne,z as xe,ab as De,av as Pe,aw as Te,ax as Ie,ay as We,az as Ve,aA as Oe,aB as Le,aC as Me,aD as Re,aE as M,J as Ue,aF as Ge}from"./index-7d8b347c.js";import{_ as He}from"./Communication-3ed9aea8.js";import{d as ze,I as Ae}from"./index.es-0a8c9ae4.js";import"./utils-7c6dc436.js";import"./arrow-down-075bb51a.js";import"./json-5c9dc7ca.js";import"./newOutline-83220d1e.js";import"./files-905044f3.js";import"./TaskOption-e7d917a4.js";import"./json-91191aeb.js";const Be={class:"sticky top-0 z-10 flex flex-shrink-0 space-x-2 overflow-x-auto bg-primary p-4"},Fe={class:"sticky top-upperSecondaryStickyFold z-10 flex flex-shrink-0 items-center justify-between overflow-x-auto border-b border-dividerLight bg-primary pl-4"},je={class:"truncate font-semibold text-secondaryLight"},qe={class:"flex"},Je={class:"draggable-content group flex divide-x divide-dividerLight border-b border-dividerLight"},Ye=["onUpdate:modelValue","placeholder","onChange"],io=te({__name:"websocket",setup(Ze){const t=ae(),C=ye(),R=se(),{subscribeToStream:U}=ne(),w=E("communication"),l=y(Te,"",Pe),r=y(We,[],Ie),$=le({get(){return r.value.map((o,a)=>({id:`protocol-${a}-${o.value}`,protocol:o}))},set(o){r.value=o.map(({protocol:a})=>a)}}),m=y(re,new ce,Ve),i=ie(m.value.connectionState$,"DISCONNECTED"),f=y(Le,[],Oe),k=E(!0),N=E([]);let g;V(l,o=>{o&&A()}),V(r,o=>{N.value=o.filter(a=>Object.prototype.hasOwnProperty.call(a,"active")?a.active===!0:!0).map(({value:a})=>a)},{deep:!0});const G=({data:o})=>{o.url===l.value&&(k.value=o.result)},H=o=>o instanceof SyntaxError?o.message:t("error.something_went_wrong").toString();de(()=>{g=new ee,g.addEventListener("message",G),U(m.value.event$,o=>{switch(o==null?void 0:o.type){case"CONNECTING":f.value=[{payload:`${t("state.connecting_to",{name:l.value})}`,source:"info",color:"var(--accent-color)",ts:void 0}];break;case"CONNECTED":f.value=[{payload:`${t("state.connected_to",{name:l.value})}`,source:"info",color:"var(--accent-color)",ts:Date.now()}],C.success(`${t("state.connected")}`);break;case"MESSAGE_SENT":S({payload:o.message,source:"client",ts:Date.now()});break;case"MESSAGE_RECEIVED":S({payload:o.message,source:"server",ts:o.time});break;case"ERROR":S({payload:H(o.error),source:"info",color:"#ff5555",ts:o.time});break;case"DISCONNECTED":S({payload:t("state.disconnected_from",{name:l.value}).toString(),source:"disconnected",color:"#ff5555",ts:o.time}),C.error(`${t("state.disconnected")}`);break}})}),ue(()=>{g&&g.terminate()});const z=()=>{Se()},A=pe(function(){g.postMessage({type:"ws",url:l.value})},1e3),x=()=>{if(i.value==="DISCONNECTED")return m.value.connect(l.value,N.value);m.value.disconnect()},B=o=>{m.value.sendMessage(o)},F=()=>{Ce({value:"",active:!0})},j=o=>{const a=r.value.slice();ke(o),C.success(`${t("state.deleted")}`,{duration:4e3,action:{text:`${t("action.undo")}`,onClick:(P,h)=>{r.value=a,h.goAway()}}})},D=(o,a)=>{he(o,a)},q=()=>{f.value=[]};return(o,a)=>{const P=Ee,h=we,J=He,T=$e,v=Ne,Y=xe,Z=De,K=oe,Q=X,_=me("tippy");return O(),L(Q,{"layout-id":"websocket"},{primary:d(()=>[c("div",Be,[n(h,{modelValue:e(l),"onUpdate:modelValue":a[0]||(a[0]=s=>ge(l)?l.value=s:null),type:"url",autofocus:!1,styles:"!inline-flex flex-1 space-x-2","input-styles":"w-full px-4 py-2 border rounded !bg-primaryLight border-divider text-secondaryDark",placeholder:`${e(t)("websocket.url")}`,disabled:e(i)==="CONNECTED"||e(i)==="CONNECTING",onSubmit:a[1]||(a[1]=s=>k.value?x():null)},{button:d(()=>[n(P,{id:"connect",disabled:!k.value,class:"w-32",name:"connect",label:e(i)==="CONNECTING"?e(t)("action.connecting"):e(i)==="DISCONNECTED"?e(t)("action.connect"):e(t)("action.disconnect"),loading:e(i)==="CONNECTING",onClick:x},null,8,["disabled","label","loading"])]),_:1},8,["modelValue","placeholder","disabled"])]),n(Z,{modelValue:w.value,"onUpdate:modelValue":a[4]||(a[4]=s=>w.value=s),styles:"sticky overflow-x-auto flex-shrink-0 bg-primary top-upperPrimaryStickyFold z-10","render-inactive-tabs":""},{default:d(()=>[n(T,{id:"communication",label:`${e(t)("websocket.communication")}`},{default:d(()=>[n(J,{"is-connected":e(i)==="CONNECTED",class:"cmResponsePrimaryStickyFold","sticky-header-styles":"top-upperSecondaryStickyFold",onSendMessage:a[2]||(a[2]=s=>B(s))},null,8,["is-connected"])]),_:1},8,["label"]),n(T,{id:"protocols",label:`${e(t)("websocket.protocols")}`},{default:d(()=>[c("div",Fe,[c("label",je,ve(e(t)("websocket.protocols")),1),c("div",qe,[p(n(v,{title:e(t)("action.clear_all"),icon:e(Me),onClick:z},null,8,["title","icon"]),[[_,{theme:"tooltip"}]]),p(n(v,{title:e(t)("add.new"),icon:e(Re),onClick:F},null,8,["title","icon"]),[[_,{theme:"tooltip"}]])])]),n(e(ze),{modelValue:$.value,"onUpdate:modelValue":a[3]||(a[3]=s=>$.value=s),"item-key":"id",animation:"250",handle:".draggable-handle",draggable:".draggable-content","ghost-class":"cursor-move","chosen-class":"bg-primaryLight","drag-class":"cursor-grabbing"},{item:d(({element:{protocol:s},index:u})=>{var I,W;return[c("div",Je,[c("span",null,[p(n(v,{icon:e(Ae),class:_e(["opacity-0",{"draggable-handle cursor-grab group-hover:opacity-100":u!==((I=e(r))==null?void 0:I.length)-1}]),tabindex:"-1"},null,8,["icon","class"]),[[_,{theme:"tooltip",delay:[500,20],content:u!==((W=e(r))==null?void 0:W.length)-1?e(t)("action.drag_to_reorder"):null}]])]),p(c("input",{"onUpdate:modelValue":b=>s.value=b,class:"flex flex-1 bg-transparent px-4 py-2",placeholder:`${e(t)("count.protocol",{count:u+1})}`,name:"message",type:"text",autocomplete:"off",onChange:b=>D(u,{value:b.target.value,active:s.active})},null,40,Ye),[[be,s.value]]),c("span",null,[p(n(v,{title:s.hasOwnProperty("active")?s.active?e(t)("action.turn_off"):e(t)("action.turn_on"):e(t)("action.turn_off"),icon:s.hasOwnProperty("active")?s.active?e(M):e(Ue):e(M),color:"green",onClick:b=>D(u,{value:s.value,active:!s.active})},null,8,["title","icon","onClick"]),[[_,{theme:"tooltip"}]])]),c("span",null,[p(n(v,{title:e(t)("action.remove"),icon:e(Ge),color:"red",onClick:b=>j(u)},null,8,["title","icon","onClick"]),[[_,{theme:"tooltip"}]])])])]}),_:1},8,["modelValue"]),e(r).length===0?(O(),L(Y,{key:0,src:`/images/states/${e(R).value}/add_category.svg`,alt:`${e(t)("empty.protocols")}`,text:`${e(t)("empty.protocols")}`},null,8,["src","alt","text"])):fe("",!0)]),_:1},8,["label"])]),_:1},8,["modelValue"])]),secondary:d(()=>[n(K,{title:e(t)("websocket.log"),log:e(f),onDelete:a[5]||(a[5]=s=>q())},null,8,["title","log"])]),_:1})}}});export{io as default};
//# sourceMappingURL=websocket-845e0e43.js.map
